---
title: "Speed Missmatch"
format:
  html:
    page-layout: full
    code-fold: true
jupyter: python3
---

```{python}
#| echo: false

from moviepy.video.io.VideoFileClip import VideoFileClip
import tempfile

VIDEO_PATH = "test_video.mp4"

# this is calculated from data (its not deterministic)
# thus videos clips are not available for adding to yaml
TIME_SEGMENTS = [(1.0, 3.0), (5.0, 7.0)]
```


```{python}
#| output: asis
#| echo: false

video = VideoFileClip(VIDEO_PATH).without_audio()

print("\n\n::: {.panel-tabset .nav-pills}\n\n")

for i, (t_start, t_end) in enumerate(TIME_SEGMENTS, start = 1):
    print(video.duration)
    video_subclip = video.subclip(
        t_start = max(0, t_start), 
        t_end = min(t_end, video.duration)
    )

    with tempfile.NamedTemporaryFile(suffix = ".mp4", delete = False) as temp_file:

        video_subclip.write_videofile(
            filename = temp_file.name,
            codec = "libx264",
            logger = None
        )

        print(f"\n\n## Video: {i}\n\n")
        print(f"\n\n{{{{< video {temp_file.name} >}}}}\n\n")

    video_subclip.reader.close()
    if video_subclip.audio:
        video_subclip.audio.reader.close_proc()

print(":::")

video.reader.close()
if video.audio:
    video.audio.reader.close_proc()
```